---
title: "Firebase Cloud Messaging (FCM)"
sidebarTitle: "FCM"
description: "Learn how to use the Firebase Cloud Messaging (FCM) provider to send push notifications using Novu"
---

[Firebase Cloud Messaging](https://firebase.google.com/docs/cloud-messaging) is a free notification delivery service provided by Google Firebase.

To enable the FCM integration, you need to get your service account key from the [Firebase Console](https://console.firebase.google.com/).

## Generating a Service Account Key JSON

To acquire the account key JSON file for your service account

1. Select your project, and click the gear icon on the top of the sidebar.
2. Head to project settings.
3. Navigate to the service account tab.
4. Click **Generate New Private Key,** then confirm by clicking **Generate Key.**
5. Clicking **Generate Key** downloads the JSON file.

After that, paste the entire JSON file content in the Service Account field of the FCM provider in the integration store on Novu’s web dashboard.

Make sure your service account json content contains these fields

```json
{
  "type": "service_account",
  "project_id": "PROJECT_ID",
  "private_key_id": "PRIVATE_KEY_ID",
  "private_key": "PRIVATE_KEY",
  "client_email": "FIREBASE_ADMIN_SDK_EMAIL",
  "client_id": "CLIENT_ID",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "CLIENT_X509_CERT_URL"
}
```

## Setting Device Token

Before triggering the notification to a subscriber(user) with push as a step in the workflow, make sure you have added the subscriber's device token as follows:

<Tabs>
  <Tab title="Node.js">
```javaScript
import {
  Novu,
  PushProviderIdEnum
} from '@novu/node';

const novu = new Novu("<NOVU_API_KEY>");

await novu.subscribers.setCredentials(
  'subscriberId',
  PushProviderIdEnum.FCM,
  { deviceTokens: ['token1', 'token2'] }
);

````
  </Tab>

  <Tab title="cURL">
```bash
curl -L -X PUT 'https://api.novu.co/v1/subscribers/<SUBSCRIBER_ID>/credentials' \
-H 'Content-Type: application/json' \
-H 'Accept: application/json' \
-H 'Authorization: ApiKey <NOVU_API_KEY>' \
-d '{
  "providerId": "fcm",
  "credentials": {
    "deviceTokens" : [
      "token1",
      "token2"
    ]
  }
}'
````

  </Tab>
</Tabs>

Checkout the [API reference](/api-reference/subscribers/update-subscriber-credentials) for more details.

## FCM Provider overrides

Novu allows you to leverage all of the custom SDK parameters that FCM provides. Here is the full list of supported overrides.

```typescript
await step.push('push-step', () => {
  return {
    body: 'Email body'
  }
}, {
  providers: {
    fcm: ({ controls }) => {
      return {
        notification: {
          title: 'Hello World',
          body: 'Email body',
          color: '#000000'
        }
      }
    }
  }
});
```

<Info> Novu uses FCM version V1</Info>

<ResponseField name="to" type="string" required={false}>
  This parameter specifies the recipient of a message. The value must be a registration token, notification key, or topic. Do not set this field when sending to multiple topics. See **condition**.
</ResponseField>

<ResponseField name="registration_ids" type="array" required={false}>
  This parameter specifies a list of devices (registration tokens, or IDs) receiving a multicast message. It must contain at least 1 and at most 1000 registration tokens. Use this parameter only for multicast messaging, not for single recipients. Multicast messages (sending to more than 1 registration tokens) are allowed using HTTP JSON format only.
</ResponseField>

<ResponseField name="condition" type="string" required={false}>
  This parameter specifies a logical expression of conditions that determine the message target. Supported condition: Topic, formatted as yourTopic in topics. This value is case-insensitive. Supported operators: &&, ||. Maximum two operators per topic message supported.
</ResponseField>

<ResponseField name="notification_key" type="string" required={false}>
  This parameter is deprecated. Instead, use **to** to specify message recipients. For more information on how to send messages to multiple devices using **to**, see [Device Group Messaging](https://firebase.google.com/docs/cloud-messaging/notifications).
</ResponseField>

<ResponseField name="collapse_key" type="string" required={false}>
  This parameter identifies a group of messages (e.g., with ```"collapse_key": "Updates Available"```) that can be collapsed, so that only the last message gets sent when delivery can be resumed. This is intended to avoid sending too many of the same messages when the device comes back online or becomes active (see **delay_while_idle**). Note that there is no guarantee of the order in which messages get sent. Note: A maximum of 4 different collapse keys is allowed at any given time. This means a FCM connection server can simultaneously store 4 different send-to-sync messages per client app. If you exceed this number, there is no guarantee which 4 collapse keys the FCM connection server will keep.
</ResponseField>

<ResponseField name="priority" type="string" required={false}>
  Sets the priority of the message. Valid values are normal and high. On iOS, these correspond to APNs priorities 5 and 10. By default, messages are sent with normal priority. Normal priority optimizes the client app's battery consumption and should be used unless immediate delivery is required. For messages with normal priority, the app may receive the message with unspecified delay. When a message is sent with high priority, it is sent immediately, and the app can wake a sleeping device and open a network connection to your server. For more information, see [Setting the priority of a message](https://firebase.google.com/docs/cloud-messaging/concept-options#setting-the-priority-of-a-message).
</ResponseField>

<ResponseField name="content_available" type="boolean" required={false}>
  On iOS, use this field to represent **content-available** in the APNS payload. When a notification or message is sent and this is set to ```true```, an inactive client app is awoken. On Android, data messages wake the app by default. On Chrome, currently not supported.
</ResponseField>

<ResponseField name="mutable_content" type="boolean" required={false}>
  Currently for iOS 10+ devices only. On iOS, use this field to represent mutable-content in the APNS payload. When a notification is sent and this is set to true, the content of the notification can be modified before it is displayed, using a [Notification Service app extension](https://developer.apple.com/reference/usernotifications/unnotificationserviceextension). This parameter will be ignored for Android and web.
</ResponseField>

<ResponseField name="delay_while_idle" type="boolean" required={false}>
  When this parameter is set to ```true```, it indicates that the message should not be sent until the device becomes active. The default value is ```false```.
</ResponseField>

<ResponseField name="time_to_live" type="number" required={false}>
  This parameter specifies how long (in seconds) the message should be kept in FCM storage if the device is offline. The maximum time to live supported is 4 weeks, and the default value is 4 weeks. For more information, see [Setting the lifespan of a message](https://firebase.google.com/docs/cloud-messaging/concept-options#ttl).
</ResponseField>

<ResponseField name="restricted_package_name" type="string" required={false}>
  This parameter specifies the package name of the application where the registration tokens must match in order to receive the message.
</ResponseField>

<ResponseField name="dry_run" type="boolean" required={false}>
  This parameter, when set to ```true```, allows developers to test a request without actually sending a message. The default value is ```false```.
</ResponseField>

<ResponseField name="data" type="object" required={false}>
  This parameter specifies the custom key-value pairs of the message's payload. For example, with ```"data":{"score":"3x1"}```: On iOS, if the message is sent via APNS, it represents the custom data fields. If it is sent via FCM connection server, it would be represented as key value dictionary in ```AppDelegate application:didReceiveRemoteNotification:```. On Android, this would result in an intent extra named **score** with the string value **3x1**. The key should not be a reserved word ("from" or any word starting with "google" or "gcm"). Do not use any of the words defined in this table (such as **collapse_key**).
</ResponseField>

<Expandable title="notification">
  <ResponseField name="title" type="string" required={false}>
    Indicates notification title. This field is not visible on iOS phones and tablets. Field is required for android.
  </ResponseField>

  <ResponseField name="body" type="string" required={false}>
    Indicates notification body text.
  </ResponseField>

  <ResponseField name="icon" type="string" required={false}>
    android: Indicates notification icon. Sets value to **myicon** for drawable resource **myicon**.
  </ResponseField>

  <ResponseField name="sound" type="string" required={false}>
    Indicates a sound to play when the device receives a notification. iOS: Sound files can be in the main bundle of the client app or in the Library/Sounds folder of the app's data container. See the [iOS Developer Library](https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/IPhoneOSClientImp.html#//apple_ref/doc/uid/TP40008194-CH103-SW6) for more information). android: Supports default or the filename of a sound resource bundled in the app. Sound files must reside in /res/raw/.
  </ResponseField>

  <ResponseField name="badge" type="string" required={false}>
    iOS: Indicates the badge on the client app home icon.
  </ResponseField>

  <ResponseField name="tag" type="string" required={false}>
    android: Indicates whether each notification results in a new entry in the notification drawer. If not set, each request creates a new notification. If set, and a notification with the same tag is already being shown, the new notification replaces the existing one in the notification drawer.
  </ResponseField>

  <ResponseField name="color" type="string" required={false}>
    android: Indicates color of the icon, expressed in #rrggbb format.
  </ResponseField>

  <ResponseField name="click_action" type="string" required={false}>
    Indicates the action associated with a user click on the notification. iOS:  Corresponds to category in the APNs payload. android: When this is set, an activity with a matching intent filter is launched when user clicks the notification.
  </ResponseField>

  <ResponseField name="body_loc_key" type="string" required={false}>
    Indicates the key to the body string for localization. iOS: Corresponds to "loc-key" in the APNs payload. android: Use the key in the app's string resources when populating this value.
  </ResponseField>

  <ResponseField name="body_loc_args" type="string" required={false}>
    Indicates the string value to replace format specifiers in the body string for localization. iOS: Corresponds to "loc-args" in the APNs payload. android:  See [Formatting and Styling](https://developer.android.com/guide/topics/resources/string-resource.html#FormattingAndStyling).
  </ResponseField>

  <ResponseField name="title_loc_key" type="string" required={false}>
    Indicates the key to the title string for localization. iOS: Corresponds to "title-loc-key" in the APNs payload. android:  Use the key in the app's string resources when populating this value.
  </ResponseField>

  <ResponseField name="title_loc_args" type="string" required={false}>
    Indicates the string value to replace format specifiers in the title string for localization. iOS: Corresponds to "title-loc-args" in the APNs payload. android: See [Formatting strings](https://developer.android.com/guide/topics/resources/string-resource.html#FormattingAndStyling).
  </ResponseField>
</Expandable>


## FAQs

<AccordionGroup>
  <Accordion title="The registration token is not a valid FCM registration token">
    You may come across an error like so:

    ""Sending message failed due to "The registration token is not a valid FCM registration token""".

    This error happens because of invalid or stale token. The fix for this is to remove old tokens, generate a new token and save it into user subscribers.

  </Accordion>
  <Accordion title="FCM notifications sent successfully with no error but push notification is not received in device">
    Try to generate a new token after clearing device cache and retry with this fresh token.
  </Accordion>
  <Accordion title="Sending message failed due to 'Requested entity was not found'">
    This error occurs when your token is no longer valid. To fix this, generate a new token and use it.
  </Accordion>
  <Accordion title="Subscriber does not have a configured channel error">
    This error occurs if the fcm integration is active but subscriber is missing from the fcm credentials (deviceTokens). The credentials (deviceTokens) for the subscriber needs to be set. 
  </Accordion>
</AccordionGroup>
